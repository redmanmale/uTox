sudo: false

language: c

addons:
  apt:
    packages:
      - cmake
      - cmake-data
      - yasm
      - check
      - libdbus-1-dev
      - libopenal-dev
      - libopenal-data
      - libopenal1
      - libv4l-dev

cache:
  directories:
    - $HOME/cache

matrix:
  fast_finish: true
  include:
    - name: "Linux Clang"
      os: linux
      env: BUILD=linux
      compiler: clang

    - name: "Windows x64"
      sudo: required
      os: linux
      env: BUILD=windows
      compiler: x86_64-w64-mingw32-gcc
      dist: trusty
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc
            - mingw-w64
            - gcc-mingw-w64
            - mingw-w64-common
            - binutils-mingw-w64
            - yasm
            - libopenal-dev
            - libopenal-data
            - libopenal1

    - os: osx
      compiler: clang
      env: BUILD=osx

git:
  depth: 5

before_script:
  - ./extra/travis/env.sh
  - ./extra/travis/${BUILD}-before.sh
  - ./extra/travis/filter_audio.sh

script:
  - ./extra/travis/${BUILD}-script.sh

after_failure:
  - ./extra/travis/debug_failure.sh

deploy:
  provider: releases
  api_key:
    secure: CfOm1RyvBfXRFpnOsrvnvNy/+WIGA8hY/Im9S6Lht4JIUOAh4IMsFdKi4suyo3SIIS7zvVeyqVJrQofcCnJfrlS4e8ab/9vrOJ0sPITbl04CgOsvaaTXoOHbB+ap/L+CKaTI24VskoBafEoX5roSERizT4ayqCnx8UBrvh2gY8unYtcOwAExdEelyWIhLKPOZ13JCTEGIZ3pNCRCPQTVDwd59uNitt1IeFEA2LpxebaiksPlgYFcJa0v6Pdr8EpCzRBqThegUIys1HXm2Sh5C1WXxfCsI62rDtkhIDB4HGOqbTch/ZVnYxtYF5/fRLGdY93R8L1EhnFB3xoCReOgqrkqkBxW09MXBbA2wcm+l0t3OuOxMNJ7Aayux+iYYjBW2QDHzMJX52qvvdYxzB3IwuMty/o9qz0IRfIxZQWKcMQjdWQn+ion7jNDQfRJ/sgzqGDOyQ3EewXqIWjF77r7v4uC+jJPSiWxTGiwaZ8U/fuuv4mkVPksm/Q1yuv57gZtFaapFi7HEXCiDyLBWYlK9g9RN500lIjQNwC/ExpTaGEWEm8B1gDAKghjm8yN1e+kpO1vW980sRIXzjaECeirFwaPjtfI9Oe/w7vLMWH6pq43AYUXJ9jXyGUa/gBgWMKNRbZcssF+Ot939lNaN4fAW4/QrS5+VRumEl+rx8Zfl5k=
  file: utox.exe
  skip_cleanup: true
  on:
    tags: true
  condition: $BUILD = windows

branches:
  except:
